<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Example1.Analysis.LinearAnalysis.CustomFunctions</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="&quot;Custom functions for automated analysis, including linearization and simulation, and their comparison&quot;">
<style type="text/css">
*       { font-size: 100%; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 90%; font-family: Courier, monospace; white-space: pre; } /* For the Modelica code (in exported html). */
h4      { font-size: 100%; font-weight: bold; color: green; } 
h3      { font-size: 110%; font-weight: bold; color: green; }
h2      { font-size: 130%; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { padding: 2px; vertical-align: top; }
th      { padding: 2px; vertical-align: top; font-weight: bold; }
table   { border-collapse: collapse; }
table[class^="ModelicaTable"] td { border: 1px solid #808080; }
table[class^="ModelicaTable"] th { border: 1px solid #808080; }
pre, code {font-family: "Courier New", monospace;}
pre {white-space: pre; overflow-x : hidden;}
.ModelicaDescription {font-weight: bold;} /* For the description string of the class. */
.ModelicaBaseClass {} /* For the list of base-classes at the of the description. */
.ModelicaKeyword { color: blue; font-weight: normal; font-style: normal; } /* Keywords in Modelica. */
.ModelicaComment { color: #006400;  font-weight: normal; font-style: normal;} /* All three variants of comments in Modelica.  */
.ModelicaString { color: #006400;  font-weight: normal; font-style: normal;} /* String constants. */
.ModelicaClass { color: red; font-weight: normal; font-style: normal;} /* Formatting the names of referenced classes (for base-class and components). */
.ModelicaFunction { color: red; font-weight: normal; font-style: normal;} /* Formatting for called functions. */
.ModelicaTablePackageContent { } /* The table of contents for each package. */
.ModelicaTableCrossReference { } /* The optional cross-reference table. */
.ModelicaTableInputs {} /* The table of inputs for a function. */
.ModelicaTableOutputs {} /* The table of outputs for a function. */
.ModelicaTableParameters {} /* The table of parameters for a model/block. */
.ModelicaTableConnectors {} /* The table of connectors for a model/block. */
.ModelicaTableContents {} /* The table of contents for a connector. */
.ModelicaStartAttribute { font-weight: bold; } /* The formatting used for start-attribute in the table of parameters, to separate them from parameter values. */
.ModelicaParameterTab { background-color: #c0c0c0; font-weight: bold; } /* The tab-heading in the table of parameters */
.ModelicaParameterGroup { background-color: #e0e0e0; } /* The group-heading in the table of parameters */
</style>
</head>
<body>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE CustomFunctions<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Example1.Analysis.LinearAnalysis.CustomFunctions"></a><a href="Example1_Analysis_LinearAnalysis.html#Example1.Analysis.LinearAnalysis"
>Example1.Analysis.LinearAnalysis</a>.CustomFunctions</h2>
<p>
<span class="ModelicaDescription">Custom functions for automated analysis, including linearization and simulation, and their comparison</span>
</p>
<h3>Information</h3>

<p>This package contains two functions for automated analysis:</p>
<ul>
<li>Simple linearization workflow: <span style="font-family: Courier New;">Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeSimple</span></li>
<li>Extended linearization workflow: <span style="font-family: Courier New;">Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeAndCompare</span></li>
</ul>

<p><span class="ModelicaBaseClass">Extends from <a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Icons_FunctionsPackage.html#Modelica.Icons.FunctionsPackage"
>Modelica.Icons.FunctionsPackage</a> (Icon for packages containing functions).</span></p>
<h3>Package Content</h3>
<table summary="Package Content" class="ModelicaTablePackageContent">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="Example1.Analysis.LinearA7601474f294abfbaimpleS.png" alt="Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeSimple" width="20" height="20" align="top">&nbsp;<a href="Example1_Analysis_LinearAnalysis_CustomFunctions.html#Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeSimple"
>LinearizeSimple</a>
</td>
<td>Linearize the model at any point in time tlin</td>
</tr>
<tr>
<td><img src="Example1.Analysis.LinearA7601474f294abfbaimpleS.png" alt="Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeAndCompare" width="20" height="20" align="top">&nbsp;<a href="Example1_Analysis_LinearAnalysis_CustomFunctions.html#Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeAndCompare"
>LinearizeAndCompare</a>
</td>
<td>Linearize the model, simulate the linear model obtained and compare with the nonlinear model response.</td>
</tr>
</table>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE LinearizeSimple<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeSimple"></a><a href="Example1_Analysis_LinearAnalysis_CustomFunctions.html#Example1.Analysis.LinearAnalysis.CustomFunctions"
>Example1.Analysis.LinearAnalysis.CustomFunctions</a>.LinearizeSimple</h2>
<p>
<span class="ModelicaDescription">Linearize the model at any point in time tlin</span>
</p>
<h3>Information</h3>

<p>This function linearizes the non-linear model at any point in time specified by the user. </p>
<p>The results are displayed in the Commands Window.</p>
<p>The obtained linear model can be used in any other environment. The linear model is available in the file, <span style="font-family: Courier New;">dslin.mat</span>, that will appear under your Dymola working directory. It can be loaded in MATLAB using the Dymola function:</p>
<p><span style="font-family: Courier New;">[A,B,C,D,xName,uName,yName] = tloadlin(&apos;dslin.mat&apos;)</span></p>
<p>Add to the MATLAB workspace the directory and sub-directories under: <span style="font-family: Courier New;">C:\Program Files\Dymola 2024x\Mfiles</span></p>
<p>In addition, the file <span style="font-family: Courier New;">MyData.mat</span> contains the <span style="font-family: Courier New;">y0</span> vector, which corresponds to the output vector at the point in time where linearization is performed. </p>
<p><i><b><span style="font-family: Arial;">Usage</span></b></i></p>
<ol>
<li><span style="font-family: Arial;">In the Package Browser, right click on the function and select &quot;Call function...&quot;. This will open the function&apos;s window.</span></li>
<p><img src="file:///C:/Users/vanfretti/Documents/Github/CCTA-OpenIPSL/Example1/Resources/Images/linsimple%20(Small).png"/></p>
<li><span style="font-family: Arial;">Leave the default parameters on first use. Alternatively, modify the tlin and tsim parameters, note that tsim should be greater or equal to tlin.</span></li>
<li><span style="font-family: Arial;">Go to the bottom of the window and click on &quot;Execute&quot;, if successful, messages/results are displayed in the command window.</span></li>
<li><span style="font-family: Arial;">Go back to the function&apos;s own window and click on &quot;Close&quot;.</span> </li>
</ol>
<p><br><i><b>Sample Output</b></i></p>
<p>Executing the function gives the following results in the &quot;Commands&quot; window.</p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeSimple();</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">DAE&nbsp;Mode&nbsp;is&nbsp;turned&nbsp;off.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Global&nbsp;optimization&nbsp;is&nbsp;disabled.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Sparse&nbsp;options&nbsp;disabled.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Linearization&nbsp;and&nbsp;Nonlinear&nbsp;Model&nbsp;Comparison&nbsp;is&nbsp;starting...</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Linearized&nbsp;Model</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Number&nbsp;of&nbsp;states:&nbsp;12</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Simulating&nbsp;nonlinear&nbsp;model</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Redeclaring&nbsp;variable:&nbsp;Real&nbsp;y0&nbsp;[7,&nbsp;1012];</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Declaring&nbsp;variable:&nbsp;Real&nbsp;y0out&nbsp;[7];</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">y0&nbsp;=&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;&quot;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">y0&nbsp;=&nbsp;&nbsp;=&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.000024318695068359375&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.196186602115631103515625&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.900009691715240478515625&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.28431034088134765625&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.50904435006304993294179e-07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.120034694671630859375&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&quot;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;376.9911183891212,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-0.17610876763748942,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.19586150145880193,&nbsp;0.05515410219837237,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-0.25587785362300375,&nbsp;0.0,&nbsp;-0.12499999997574654,&nbsp;0.0,&nbsp;-0.2667630481888344,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.001159492170868593,&nbsp;0.0,&nbsp;0.0,&nbsp;0.12499999999488744,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.4265899899207167,&nbsp;0.0,&nbsp;0.0,&nbsp;-1.0000000000939857,&nbsp;0.007883244407403102,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-1.4901043751184482,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-3.3690289136967633,&nbsp;0.0,&nbsp;33.3333333351218,&nbsp;0.0,&nbsp;-36.84568272027127,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.015266513308270566,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">2.4254614215865864,&nbsp;0.0,&nbsp;0.0,&nbsp;14.285714287056937,&nbsp;0.04482173884230768,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-22.75799624545071,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-8.934890956417721,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;29.303251383490004,&nbsp;33.12307890942945,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-66.66666667217629,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-1.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;18999999.999786172,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-2000000.0001652886,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;10000.00082740371,&nbsp;-9999.999999590995,&nbsp;0.0,&nbsp;0.0,&nbsp;-18999999.99980534;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.009499999999893087,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.001,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.009499999999902671;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.009499999999893087,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.001,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.009499999999902671;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.7092198580776662,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.7092198581570424],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.14285715467719584,&nbsp;-0.03160725649463204,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-0.04042882695287631,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.10093337277083947,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-0.532308225276168,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.5738762639698587,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-1.0247506547026812,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">19000001.57206705,&nbsp;0.0,&nbsp;0.0,&nbsp;2000000.1654807418;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.009500000786033523,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.009500000786033523,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.7092199168371426,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[-0.13402336434626583,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.43954877075235005,&nbsp;0.4968461836414418,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.3043068141629995,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.4537261850177308,&nbsp;0.7665888604391177,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">1.2253264601006595,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.3643245623264468,&nbsp;-0.38254244268485077,&nbsp;0.0,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.9999999998895094,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">1.0000000001010991,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;9.499999999893086,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-9.49999999990267;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.9999999999590995,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;0.0,&nbsp;-0.015371259820540216,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.02120334463562301,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.21999579935538804,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">9.500000786033524,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;{&quot;uPSS&quot;,&nbsp;&quot;uPm&quot;,&nbsp;&quot;uPload&quot;,&nbsp;&quot;uvsAVR&quot;},&nbsp;{&quot;Vt&quot;,&nbsp;&quot;Q&quot;,&nbsp;&quot;P&quot;,&nbsp;&quot;w&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;delta&quot;,&nbsp;&quot;AVRin&quot;,&nbsp;&quot;AVRout&quot;},&nbsp;{&quot;Plant.G1.machine.delta&quot;,&nbsp;&quot;Plant.G1.machine.w&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;Plant.G1.machine.e1q&quot;,&nbsp;&quot;Plant.G1.machine.e1d&quot;,&nbsp;&quot;Plant.G1.machine.e2q&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;Plant.G1.machine.e2d&quot;,&nbsp;&quot;Plant.G1.avr.vm&quot;,&nbsp;&quot;Plant.G1.avr.vr&quot;,&nbsp;&quot;Plant.G1.avr.vf1&quot;,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&quot;Plant.G1.pss.imLeadLag.TF.x_scaled[1]&quot;,&nbsp;&quot;Plant.G1.pss.imLeadLag1.TF.x_scaled[1]&quot;,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&quot;Plant.G1.pss.derivativeLag.TF.x_scaled[1]&quot;}</span></p>

<h3>Inputs</h3>
<table summary="Inputs" class="ModelicaTableInputs">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Time</a></td><td>tlin</td><td>40</td><td>t for model linearization [s]</td></tr>
<tr><td><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Time</a></td><td>tsim</td><td>40</td><td>Simulation time [s]</td></tr>
<tr><td>String</td><td>pathToNonlinearPlantModel</td><td title=""Example1.Analysis.LinearAnalysis.NonlinModel_for_Linearization"">&quot;Example1.Analysis.LinearAna...</td><td>Nonlinear model for linearization</td></tr>
<tr><td>String</td><td>pathToNonlinearExperiment</td><td title=""Example1.Analysis.LinearAnalysis.NonlinModel_for_NonlinExperiment"">&quot;Example1.Analysis.LinearAna...</td><td>Nonlinear Model for simulation</td></tr>
</table>
<h3>Outputs</h3>
<table summary="Outputs" class="ModelicaTableOutputs">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>Real</td><td>A[:, :]</td><td>A-matrix</td></tr>
<tr><td>Real</td><td>B[:, :]</td><td>B-matrix</td></tr>
<tr><td>Real</td><td>C[:, :]</td><td>C-matrix</td></tr>
<tr><td>Real</td><td>D[:, :]</td><td>D-matrix</td></tr>
<tr><td>String</td><td>inputNames[:]</td><td>Modelica names of inputs</td></tr>
<tr><td>String</td><td>outputNames[:]</td><td>Modelica names of outputs</td></tr>
<tr><td>String</td><td>stateNames[:]</td><td>Modelica names of states</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">function</span> LinearizeSimple
  <span class="ModelicaComment">&quot;Linearize the model at any point in time tlin&quot;</span>
  <span class="ModelicaComment">// Import things needed for the calculations</span>
  <span class="ModelicaKeyword">import </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica_LinearSystems2%202.4.0/help/Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</a>;<span class="ModelicaComment"> // to create and manipulate state space objects</span>
  <span class="ModelicaComment">// Declare outputs to display</span>
  <span class="ModelicaKeyword">output </span>Real A[:,:] <span class="ModelicaComment">&quot;A-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real B[:,:] <span class="ModelicaComment">&quot;B-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real C[:,:] <span class="ModelicaComment">&quot;C-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real D[:,:] <span class="ModelicaComment">&quot;D-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>String inputNames[:] <span class="ModelicaComment">&quot;Modelica names of inputs&quot;</span>;
  <span class="ModelicaKeyword">output </span>String outputNames[:] <span class="ModelicaComment">&quot;Modelica names of outputs&quot;</span>;
  <span class="ModelicaKeyword">output </span>String stateNames[:] <span class="ModelicaComment">&quot;Modelica names of states&quot;</span>;
  <span class="ModelicaComment">// Declare reconfigurable inputs</span>
  <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Modelica.Units.SI.Time</a> tlin=40 <span class="ModelicaComment">&quot;t for model linearization&quot;</span>;
  <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Modelica.Units.SI.Time</a> tsim=40 <span class="ModelicaComment">&quot;Simulation time&quot;</span>;
  <span class="ModelicaKeyword">input </span>String pathToNonlinearPlantModel = &quot;Example1.Analysis.LinearAnalysis.NonlinModel_for_Linearization&quot; <span class="ModelicaComment">&quot;Nonlinear model for linearization&quot;</span>;
  <span class="ModelicaKeyword">input </span>String pathToNonlinearExperiment = &quot;Example1.Analysis.LinearAnalysis.NonlinModel_for_NonlinExperiment&quot; <span class="ModelicaComment">&quot;Nonlinear Model for simulation&quot;</span>;
<span class="ModelicaKeyword">algorithm </span>
  <span class="ModelicaComment">// Make sure DAE mode is off!</span>
  Advanced.Define.DAEsolver := false;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;DAE Mode is turned off.&quot;);
  Advanced.Define.GlobalOptimizations :=0;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Global optimization is disabled.&quot;);
  Advanced.SparseActivate :=false;
  Advanced.Translation.SparseActivateIntegrator :=false;
  Advanced.Translation.SparseActivateSystems :=false;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Sparse options disabled.&quot;);
  OutputCPUtime :=false;<span class="ModelicaComment"> // disable cpu time output so it doesn&#39;t scre up the sizes of the outputs</span>
  <span class="ModelicaComment">// Start the linearization process</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Linearization and Nonlinear Model Comparison is starting...&quot;);
  <span class="ModelicaComment">// Compute and display the ABCD matrices, etc</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Linearized Model&quot;);
  (A,B,C,D,inputNames,outputNames,stateNames) :=
    <span class="ModelicaFunction">Modelica_LinearSystems2.Utilities.Import.linearize</span>(
    pathToNonlinearPlantModel,tlin);
  nx :=<span class="ModelicaFunction"> size</span>(A, 1);<span class="ModelicaComment"> //number of states</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Number of states: &quot; +<span class="ModelicaFunction"> String</span>(nx));
  <span class="ModelicaComment">// Now we want to extract the initial value of the outputs to use it in our</span>
  <span class="ModelicaComment">// linear model response</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Simulating nonlinear model&quot;);
  <span class="ModelicaFunction">simulateModel</span>(
    pathToNonlinearExperiment,
    stopTime=tsim,
    numberOfIntervals=1000, tolerance = 1e-6,
    resultFile=&quot;res_nl&quot;);
   ylen :=<span class="ModelicaFunction">DymolaCommands.Trajectories.readTrajectorySize</span>(&quot;res_nl.mat&quot;);
   ny :=<span class="ModelicaFunction"> size</span>(C, 1);
   y0 :=<span class="ModelicaFunction"> DymolaCommands.Trajectories.readTrajectory</span>(
     &quot;res_nl.mat&quot;,
     {outputNames[i] <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:ny},
     <span class="ModelicaFunction">DymolaCommands.Trajectories.readTrajectorySize</span>(&quot;res_nl.mat&quot;));
  <span class="ModelicaFunction"> DataFiles.writeMATmatrix</span>(
     &quot;MyData.mat&quot;,
     &quot;y0&quot;,
     [y0[1:ny,ylen]],
     append=true);
  <span class="ModelicaComment">// Print y0&#39;s last values which is needed for the linear response model</span>
  y0out := y0[:,ylen];<span class="ModelicaComment"> // we only want the last few elements</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;y0 = &quot;);
  <span class="ModelicaFunction">Modelica.Math.Vectors.toString</span>(y0out,name=&quot;y0 = &quot;,significantDigits=24);
<span class="ModelicaKeyword">end </span>LinearizeSimple;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE LinearizeAndCompare<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeAndCompare"></a><a href="Example1_Analysis_LinearAnalysis_CustomFunctions.html#Example1.Analysis.LinearAnalysis.CustomFunctions"
>Example1.Analysis.LinearAnalysis.CustomFunctions</a>.LinearizeAndCompare</h2>
<p>
<span class="ModelicaDescription">Linearize the model, simulate the linear model obtained and compare with the nonlinear model response.</span>
</p>
<h3>Information</h3>

<p>This function can linearize the model at initialization or at a user provided point in time. Once the model is linearized, linear model and the nonlinear models are simulated.</p>
<p>The response of both models is then plotted/compared to check the quality of the linear model.</p>
<p>The function uses the following models:</p>
<ul>
<li>Non-linear model for linearization: <span style="font-family: Courier New;">Example1.Analysis.LinearAnalysis.NonlinModel_for_Linearization</span></li>
<li>Non-linear model for simulation: <span style="font-family: Courier New;">Example1.Analysis.LinearAnalysis.NonlinModel_for_NonlinExperiment</span></li>
<li>Linear model for simualtion: <span style="font-family: Courier New;">Example1.Analysis.LinearAnalysis.LinearModelGeneral</span></li>
</ul>
<p>After executing the function the results are displayed in the command window. </p>
<p><br>For post-processing, the follwing <span style="font-family: Courier New;">.mat</span> files are generated with time simulation responses are produced:</p>
<ul>
<li><span style="font-family: Courier New;">res_lin.mat</span>, containing the time response of the linear model obtained by linearizing the linear model for simulation.</li>
<li><span style="font-family: Courier New;">res_nl.mat</span>, containing the time response of the non-linear model.</li>
<li><span style="font-family: Courier New;">res_nl_beforedist.mat</span>, containing the time response of the non-linear model up to the poin in time where the model is linearized. This is used to extract the <span style="font-family: Courier New;">y0</span> output vector that is used in the linear model for simulation.</li>
<li>These files can be opened in MATLAB using the <span style="font-family: Courier New;">dymbrowse</span> tool. Add to the MATLAB workspace the directory and sub-directories under: <span style="font-family: Courier New;">C:\Program Files\Dymola 2024x\Mfiles</span>, and in the command window of MATLAB enter: <span style="font-family: Courier New;">dymbrowse</span> and selected the data to plot.</li>
</ul>
<p><br>The linearized model is contained in the following .mat files:</p>
<ul>
<li><span style="font-family: Courier New;">MyData.mat</span> contains the <span style="font-family: Courier New;">y0</span> vector, which corresponds to the output vector at the point in time where linearization is performed.</li>
<li><span style="font-family: Courier New;">dslin.mat</span> contains the linear model obtained at the specified point for lineariation.</li>
<li>The obtained linear model can be used in any other environment. The linear model is available in the file, <span style="font-family: Courier New;">dslin.mat</span>. It can be loaded in MATLAB using the Dymola function <span style="font-family: Courier New;">[A,B,C,D,xName,uName,yName] = tloadlin(&apos;dslin.mat&apos;)</span></li>
</ul>
<p><i><b><span style="font-family: Arial;">Usage</span></b></i></p>
<ol>
<li><span style="font-family: Arial;">In the Package Browser, right click on the function and select &quot;Call function...&quot;. This will open the function&apos;s window.</span></li>
<p><img src="file:///C:/Users/vanfretti/Documents/Github/CCTA-OpenIPSL/Example1/Resources/Images/lincompare%20(Small).png"/></p>
<li><span style="font-family: Arial;">Leave the default parameters on first use. Alternatively, modify the tlin and tsim parameters, note that tsim should be greater or equal to tlin.</span></li>
<li><span style="font-family: Arial;">Go to the bottom of the window and click on &quot;Execute&quot;, if successful, messages/results are displayed in the command window.</span></li>
<li><span style="font-family: Arial;">Go back to the function&apos;s own window and click on &quot;Close&quot;.</span> </li>
</ol>
<p><br><i><b>Sample Output</b></i></p>
<p>Executing the function gives the following plot is produced in the &quot;Simulation&quot; window and the following results in the &quot;Commands&quot; window.</p>
<p><img src="file:///C:/Users/vanfretti/Documents/Github/CCTA-OpenIPSL/Example1/Resources/Images/LinearizeAndCompare.png"/></p>
<p style="margin-left: 30px;"><br><span style="font-family: Courier New; font-size: 10pt;">Example1.Analysis.LinearAnalysis.CustomFunctions.LinearizeAndCompare();</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">DAE&nbsp;Mode&nbsp;is&nbsp;turned&nbsp;off.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Global&nbsp;optimization&nbsp;is&nbsp;disabled.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Sparse&nbsp;options&nbsp;disabled.</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Linearization&nbsp;and&nbsp;Nonlinear&nbsp;Model&nbsp;Comparison&nbsp;is&nbsp;starting...</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Simulating&nbsp;nonlinear&nbsp;model</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">y0&nbsp;before&nbsp;disturbance&nbsp;=</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;&quot;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.998271&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.203063&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.921617&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.29897&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3.55698e-11&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.12495&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&quot;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">Simulating&nbsp;linear&nbsp;model</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;true</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;1</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;=&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;376.99111838906373,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-0.17610876767279915,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.19586150142483613,&nbsp;0.05515410219997556,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-0.25587785359503384,&nbsp;0.0,&nbsp;-0.12500000002903436,&nbsp;0.0,&nbsp;-0.2667630481021101,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.001159492170902296,&nbsp;0.0,&nbsp;0.0,&nbsp;0.12500000001466172,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.42658999050935953,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.9999999998908723,&nbsp;0.007883244274318683,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-1.4901043751617613,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-3.369028913176898,&nbsp;0.0,&nbsp;33.33333333281978,&nbsp;0.0,&nbsp;-36.84568271688989,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.015266512953637873,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">2.425461424825778,&nbsp;0.0,&nbsp;0.0,&nbsp;14.285714284155317,&nbsp;0.0448217383657263,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-22.75799624611222,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">-8.934890939628422,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;29.303251372407868,&nbsp;33.1230788990298,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-66.66666667021094,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-1.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;18999999.999783278,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-2000000.0001063284,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;10000.00082740371,&nbsp;-10000.000001172937,&nbsp;0.0,&nbsp;0.0,&nbsp;-18999999.996308953;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.00949999999989164,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.001,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.009499999998154478;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.00949999999989164,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;-0.001,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.009499999998154478;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.7092198580775582,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-0.7092198580803518],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.14285715467719584,&nbsp;-0.03160719305331635,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-0.040428715930573844,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.10093331725968824,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-0.5323070687938507,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.5738766604780818,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;-1.024765457676343,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">19000001.57206705,&nbsp;0.0,&nbsp;0.0,&nbsp;2000000.1654807418;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.009500000786033523,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.009500000786033523,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.7092199168371426,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[-0.1340233640944263,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.43954877058611797,&nbsp;0.496846183485447,&nbsp;0.0,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.3043068137697762,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.4537261847736198,&nbsp;0.7665888603335728,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">1.2253264605206322,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.364324561691764,&nbsp;-0.38254244286640693,&nbsp;0.0,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.9999999998893571,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">1.0000000001610603,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;9.499999999891639,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-9.499999998154477;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0000000001172937,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">[0.0,&nbsp;0.0,&nbsp;-0.01537148186514514,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.02120284503526193,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.21999546628848066,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">9.500000786033524,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;0.0],&nbsp;{&quot;uPSS&quot;,&nbsp;&quot;uPm&quot;,&nbsp;&quot;uPload&quot;,&nbsp;&quot;uvsAVR&quot;},&nbsp;{&quot;Vt&quot;,&nbsp;&quot;Q&quot;,&nbsp;&quot;P&quot;,&nbsp;&quot;w&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;delta&quot;,&nbsp;&quot;AVRin&quot;,&nbsp;&quot;AVRout&quot;},&nbsp;{&quot;Plant.G1.machine.delta&quot;,&nbsp;&quot;Plant.G1.machine.w&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;Plant.G1.machine.e1q&quot;,&nbsp;&quot;Plant.G1.machine.e1d&quot;,&nbsp;&quot;Plant.G1.machine.e2q&quot;,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&quot;Plant.G1.machine.e2d&quot;,&nbsp;&quot;Plant.G1.avr.vm&quot;,&nbsp;&quot;Plant.G1.avr.vr&quot;,&nbsp;&quot;Plant.G1.avr.vf1&quot;,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&quot;Plant.G1.pss.imLeadLag.TF.x_scaled[1]&quot;,&nbsp;&quot;Plant.G1.pss.imLeadLag1.TF.x_scaled[1]&quot;,</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&quot;Plant.G1.pss.derivativeLag.TF.x_scaled[1]&quot;},&nbsp;{0.9982708096504211,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;0.20306333899497986,&nbsp;0.9216165542602539,&nbsp;1.0,&nbsp;1.2989709377288818,&nbsp;</span></p>
<p style="margin-left: 30px;"><span style="font-family: Courier New; font-size: 10pt;">&nbsp;&nbsp;-3.5569769352150615E-11,&nbsp;2.124945878982544}</span></p>

<h3>Inputs</h3>
<table summary="Inputs" class="ModelicaTableInputs">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Time</a></td><td>tlin</td><td>30.5</td><td>t for model linearization [s]</td></tr>
<tr><td><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Time</a></td><td>tsim</td><td>40</td><td>Simulation time [s]</td></tr>
<tr><td>Real</td><td>numberOfIntervalsin</td><td>10000</td><td>No. of intervals</td></tr>
<tr><td>String</td><td>methodin</td><td>&quot;DASSL&quot;</td><td>Solver</td></tr>
<tr><td>Real</td><td>fixedstepsizein</td><td>1e-6</td><td>Time step - needed only for fixed time step solvers</td></tr>
<tr><td>String</td><td>pathToNonlinearPlantModel</td><td title=""Example1.Analysis.LinearAnalysis.NonlinModel_for_Linearization"">&quot;Example1.Analysis.LinearAna...</td><td>Nonlinear plant model</td></tr>
<tr><td>String</td><td>pathToNonlinearExperiment</td><td title=""Example1.Analysis.LinearAnalysis.NonlinModel_for_NonlinExperiment"">&quot;Example1.Analysis.LinearAna...</td><td>Nonlinear experiment model</td></tr>
<tr><td>String</td><td>pathToLinearExperiment</td><td title=""Example1.Analysis.LinearAnalysis.LinearModelGeneral"">&quot;Example1.Analysis.LinearAna...</td><td>Linear model for simulation</td></tr>
</table>
<h3>Outputs</h3>
<table summary="Outputs" class="ModelicaTableOutputs">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td>Real</td><td>A[:, :]</td><td>A-matrix</td></tr>
<tr><td>Real</td><td>B[:, :]</td><td>B-matrix</td></tr>
<tr><td>Real</td><td>C[:, :]</td><td>C-matrix</td></tr>
<tr><td>Real</td><td>D[:, :]</td><td>D-matrix</td></tr>
<tr><td>String</td><td>inputNames[:]</td><td>Modelica names of inputs</td></tr>
<tr><td>String</td><td>outputNames[:]</td><td>Modelica names of outputs</td></tr>
<tr><td>String</td><td>stateNames[:]</td><td>Modelica names of states</td></tr>
<tr><td>Real</td><td>y0out[:]</td><td>Initial value of the output variables</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span class="ModelicaKeyword">function</span> LinearizeAndCompare
  <span class="ModelicaComment">&quot;Linearize the model, simulate the linear model obtained and compare with the nonlinear model response.&quot;</span>
  <span class="ModelicaComment">// See the Documentation for an explanation of the goals.</span>
  <span class="ModelicaComment">// IMPORTING FUNCTIONS</span>
  <span class="ModelicaComment">// Import things needed for the calculations</span>
  <span class="ModelicaKeyword">import </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica_LinearSystems2%202.4.0/help/Modelica_LinearSystems2.html#Modelica_LinearSystems2.StateSpace"
>Modelica_LinearSystems2.StateSpace</a>;<span class="ModelicaComment"> // to create and manipulate state space objects</span>
  <span class="ModelicaComment">// OUTPUTS OF THEFUNCTION - FOR DISPLAY</span>
  <span class="ModelicaComment">// Declare outputs to display</span>
  <span class="ModelicaKeyword">output </span>Real A[:,:] <span class="ModelicaComment">&quot;A-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real B[:,:] <span class="ModelicaComment">&quot;B-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real C[:,:] <span class="ModelicaComment">&quot;C-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real D[:,:] <span class="ModelicaComment">&quot;D-matrix&quot;</span>;
  <span class="ModelicaKeyword">output </span>String inputNames[:] <span class="ModelicaComment">&quot;Modelica names of inputs&quot;</span>;
  <span class="ModelicaKeyword">output </span>String outputNames[:] <span class="ModelicaComment">&quot;Modelica names of outputs&quot;</span>;
  <span class="ModelicaKeyword">output </span>String stateNames[:] <span class="ModelicaComment">&quot;Modelica names of states&quot;</span>;
  <span class="ModelicaKeyword">output </span>Real y0out[:] <span class="ModelicaComment">&quot;Initial value of the output variables&quot;</span>;
  <span class="ModelicaComment">// INPUTS TO THE FUNCTION</span>
  <span class="ModelicaComment">// Declare reconfigurable simulation parameters</span>
  <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Modelica.Units.SI.Time</a> tlin=30.5 <span class="ModelicaComment">&quot;t for model linearization&quot;</span>;
  <span class="ModelicaKeyword">input </span><a href="file:///C:/Program%20Files/Dymola%202024x/Modelica/Library/Modelica%204.0.0/help/Modelica_Units_SI.html#Modelica.Units.SI.Time"
>Modelica.Units.SI.Time</a> tsim=40 <span class="ModelicaComment">&quot;Simulation time&quot;</span>;
  <span class="ModelicaKeyword">input </span>Real numberOfIntervalsin=10000 <span class="ModelicaComment">&quot;No. of intervals&quot;</span>;
  <span class="ModelicaKeyword">input </span>String methodin = &quot;DASSL&quot; <span class="ModelicaComment">&quot;Solver&quot;</span>;
  <span class="ModelicaKeyword">input </span>Real fixedstepsizein= 1e-6 <span class="ModelicaComment">&quot;Time step - needed only for fixed time step solvers&quot;</span>;
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">// DEFINING THE NONLINEAR PLANT, NONLINEAR EXPERIMENT, AND LINEAR EXPERIMENT MODELS</span>
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">// 1) NONLINEAR PLANT:</span>
  <span class="ModelicaComment">// This is the model that will be linearized, i.e. the nonlinear plant model</span>
   <span class="ModelicaKeyword">input </span>String pathToNonlinearPlantModel = &quot;Example1.Analysis.LinearAnalysis.NonlinModel_for_Linearization&quot; <span class="ModelicaComment">&quot;Nonlinear plant model&quot;</span>;
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">// 2) NONLINEAR EXPERIMENT: this is a model which applies a change to the input of the nonlinear model.</span>
  <span class="ModelicaComment">// It must match the nonlinar plant above.</span>
  <span class="ModelicaComment">// This model will be simulated, and the simulation results will be compared to the simulation of the corresponding linearized model.</span>
  <span class="ModelicaKeyword">input </span>String pathToNonlinearExperiment= &quot;Example1.Analysis.LinearAnalysis.NonlinModel_for_NonlinExperiment&quot; <span class="ModelicaComment">&quot;Nonlinear experiment model&quot;</span>;
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">// 3) LINEAR EXPERIMENT: this is a template that can be used for all three cases, so it is not necessary to create other cases here</span>
  <span class="ModelicaKeyword">input </span>String pathToLinearExperiment = &quot;Example1.Analysis.LinearAnalysis.LinearModelGeneral&quot; <span class="ModelicaComment">&quot;Linear model for simulation&quot;</span>;

<span class="ModelicaKeyword">algorithm </span>
  <span class="ModelicaComment">// Make sure DAE mode is off!</span>
  Advanced.Define.DAEsolver := false;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;DAE Mode is turned off.&quot;);
  Advanced.Define.GlobalOptimizations :=0;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Global optimization is disabled.&quot;);
  Advanced.SparseActivate :=false;
  Advanced.Translation.SparseActivateIntegrator :=false;
  Advanced.Translation.SparseActivateSystems :=false;
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Sparse options disabled.&quot;);
  OutputCPUtime :=false;<span class="ModelicaComment"> // disable cpu time output so it doesn&#39;t scre up the sizes of the outputs</span>
  <span class="ModelicaComment">// Start the linearization process</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Linearization and Nonlinear Model Comparison is starting...&quot;);
  <span class="ModelicaComment">// Compute and display the ABCD matrices, etc</span>
  (A,B,C,D,inputNames,outputNames,stateNames) :=
    <span class="ModelicaFunction">Modelica_LinearSystems2.Utilities.Import.linearize</span>(
    pathToNonlinearPlantModel,tlin);
  <span class="ModelicaComment">// LINEARIZE plant model at t_lin</span>
  <span class="ModelicaComment">// This is the same as above, however, it stores it in a StateSpace object</span>
  ss :=<span class="ModelicaFunction"> Modelica_LinearSystems2.ModelAnalysis.Linearize</span>(
    pathToNonlinearPlantModel, simulationSetup=
    <span class="ModelicaFunction">Modelica_LinearSystems2.Records.SimulationOptionsForLinearization</span>(
    linearizeAtInitial=false, t_linearize=tlin));
  <span class="ModelicaComment">// SAVE the data in a mat file</span>
  <span class="ModelicaFunction">DataFiles.writeMATmatrix</span>(
    &quot;MyData.mat&quot;,
    &quot;ABCD&quot;,
    [ss.A, ss.B; ss.C, ss.D],
    append=false);
  nx :=<span class="ModelicaFunction"> size</span>(ss.A, 1);
  <span class="ModelicaFunction">DataFiles.writeMATmatrix</span>(
    &quot;MyData.mat&quot;,
    &quot;nx&quot;,
    [nx],
    append=true);
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Simulating nonlinear model&quot;);
  <span class="ModelicaFunction">simulateModel</span>(
    pathToNonlinearExperiment,
    stopTime=tsim,
    numberOfIntervals=numberOfIntervalsin, method = methodin, fixedstepsize=fixedstepsizein,
    resultFile=&quot;res_nl&quot;);

  <span class="ModelicaFunction"> simulateModel</span>(
     pathToNonlinearExperiment,
     stopTime=tlin,
     numberOfIntervals=numberOfIntervalsin, method = methodin, fixedstepsize=fixedstepsizein,
     resultFile=&quot;res_nl_beforedist&quot;);
    ny :=<span class="ModelicaFunction"> size</span>(ss.C, 1);
    ylen :=<span class="ModelicaFunction">DymolaCommands.Trajectories.readTrajectorySize</span>(&quot;res_nl_beforedist.mat&quot;);
    y0 :=<span class="ModelicaFunction"> DymolaCommands.Trajectories.readTrajectory</span>(
      &quot;res_nl_beforedist.mat&quot;,
      {ss.yNames[i] <span class="ModelicaKeyword">for </span>i<span class="ModelicaKeyword"> in </span>1:ny},
      <span class="ModelicaFunction">DymolaCommands.Trajectories.readTrajectorySize</span>(&quot;res_nl_beforedist.mat&quot;));
  <span class="ModelicaFunction">  DataFiles.writeMATmatrix</span>(
      &quot;MyData.mat&quot;,
      &quot;y0_beforedist&quot;,
      [y0[1:ny,ylen-100]],
      append=true);

  <span class="ModelicaComment">// Print y0&#39;s first values which is needed for the linear response model</span>
  y0out := y0[1:ny,ylen];<span class="ModelicaComment"> // we only want the elements at ylen</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;y0 before disturbance =&quot;);
  <span class="ModelicaFunction">Modelica.Math.Vectors.toString</span>(y0out);
  <span class="ModelicaComment">//</span>
  <span class="ModelicaComment">// We now simulate the linear model, which requires y0</span>
  <span class="ModelicaFunction">Modelica.Utilities.Streams.print</span>(&quot;Simulating linear model&quot;);
  <span class="ModelicaFunction">simulateModel</span>(
    pathToLinearExperiment,
    stopTime=tsim,
    numberOfIntervals=numberOfIntervalsin, method = methodin, fixedstepsize=fixedstepsizein,
    resultFile=&quot;res_lin&quot;);
  <span class="ModelicaComment">  // Plot</span>
<span class="ModelicaFunction">removePlots</span>(true);
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;Vt&quot;}, range={0.0, 20.0, 0.998, 1.002}, grid=true, filename=&quot;res_nl.mat&quot;, colors={{28,108,200}}, displayUnits={&quot;1&quot;});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;Q&quot;}, range={0.0, 20.0, 0.18, 0.21}, grid=true, subPlot=102, colors={{28,108,200}}, displayUnits={&quot;1&quot;});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;P&quot;}, range={0.0, 20.0, 0.86, 0.94}, grid=true, subPlot=103, colors={{28,108,200}}, displayUnits={&quot;1&quot;});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;w&quot;}, range={0.0, 20.0, 0.9996, 1.0004}, grid=true, subPlot=104, colors={{28,108,200}}, displayUnits={&quot;1&quot;});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;delta&quot;}, range={0.0, 20.0, 1.27, 1.3}, grid=true, subPlot=105, colors={{28,108,200}}, displayUnits={&quot;rad&quot;});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;Vt&quot;}, range={0.0, 20.0, 0.998, 1.002}, erase=false, grid=true, filename=&quot;res_lin.mat&quot;, colors={{238,46,47}});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;Q&quot;}, range={0.0, 20.0, 0.18, 0.21}, erase=false, grid=true, subPlot=102, colors={{238,46,47}});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;P&quot;}, range={0.0, 20.0, 0.86, 0.94}, erase=false, grid=true, subPlot=103, colors={{238,46,47}});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;w&quot;}, range={0.0, 20.0, 0.9996, 1.0004}, erase=false, grid=true, subPlot=104, colors={{238,46,47}});
<span class="ModelicaFunction">createPlot</span>(id=1, position={-2, 1, 584, 782}, y={&quot;delta&quot;}, range={0.0, 20.0, 1.27, 1.3}, erase=false, grid=true, subPlot=105, colors={{238,46,47}});

<span class="ModelicaKeyword">end </span>LinearizeAndCompare;
</div>
<hr>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Fri Mar  8 12:46:09 2024.
</address>
</body>
</html>
